<?xml version="1.0" encoding="utf-8"?>

<mx:WindowedApplication xmlns:mx="http://www.adobe.com/2006/mxml"
                        creationComplete="initializeApplication()"
                        showStatusBar="false"
        >
    <mx:Script>
		<![CDATA[
        import light.book.exif.ExifComponent;
        import light.book.exif.ExifError;
        import light.book.exif.ExifFault;
        import light.book.exif.ExifResult;

        import logging.ConsoleTarget;
        import logging.TextTarget;

        import mx.logging.ILogger;
        import mx.logging.Log;
        import mx.utils.ObjectUtil;

        private static const log:ILogger = Log.getLogger("ExifExtensionDemo.mxml");

        private var extension:ExifComponent;

        private function initializeApplication():void
        {
            Log.addTarget(new ConsoleTarget());
            Log.addTarget(new TextTarget(output));

            log.info("started: debug {0}", Capabilities.isDebugger);
            NativeApplication.nativeApplication.addEventListener(Event.EXITING, onExit, false, 0, true);

            extension = new ExifComponent("ExifExtensionDemo");
            extension.addEventListener(ExifResult.RESULT, onResult, false, 0, true);
            extension.addEventListener(ExifFault.FAULT, onError, false, 0, true);
        }

        private function onError(event:ExifFault):void
        {
            log.error("Code: {0} returned: {1}", event.code, event.error);
        }

        private function onResult(event:ExifResult):void
        {

            log.info("Code: {0} returned: {1}", event.code, ObjectUtil.toString(event.result.info));
        }

        private function onExit(event:Event):void
        {
            extension.dispose();
        }

        private function onClick(event:MouseEvent):void
        {
//            for(var i:int = 0; i< 10; i++)
//            {
                var programShortPath:String = extension.getShortPath(exiftool.text);
                var fileShortPath:String = extension.getShortPath(params.text);
                var code:int = extension.execute(programShortPath, fileShortPath, "", 512000, -1);
                log.info("execute() code: {0}", code);
//            }
        }

        private function onClick2(event:MouseEvent):void
        {
            var path:String = extension.getShortPath(exiftool.text);
            log.info("getShortPath() {0}", path);
        }
        ]]>
	</mx:Script>
    <mx:VBox height="100%" width="100%">
        <mx:VDividedBox height="100%" width="100%">
            <mx:TextArea id="output" width="100%" height="100%" fontFamily="Courier new" editable="false"/>
            <mx:VBox width="100%">
                <mx:TextInput id="exiftool" width="100%" text="c:\Dev\light-book\trunk\ExifComponent\exiftool.exe"/>
                <mx:TextInput id="params" width="100%" text="c:\Dev\light-book\trunk\ExifComponent\test.fb2"/>
            </mx:VBox>
        </mx:VDividedBox>
        <mx:HBox>
            <mx:Button label="Run ExifTool" click="onClick(event)"/>
            <mx:Button label="Get short path" click="onClick2(event)"/>
        </mx:HBox>
    </mx:VBox>
</mx:WindowedApplication>